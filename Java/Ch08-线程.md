# çº¿ç¨‹

> ğŸ“ **è¯¾ç¨‹**: Javaè¯­è¨€ç¨‹åºè®¾è®¡ ç¬¬å…«ç« 
> 
> ğŸ¯ **å­¦ä¹ ç›®æ ‡**: æŒæ¡Javaå¤šçº¿ç¨‹ç¼–ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µä¸å®è·µåº”ç”¨

---

## ğŸ“‹ ç›®å½•ç»“æ„

```mermaid
mindmap
  root((çº¿ç¨‹))
    åŸºç¡€æ¦‚å¿µ
      Javaä¸­çš„çº¿ç¨‹
      çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ
      çº¿ç¨‹çš„ä¼˜å…ˆçº§ä¸è°ƒåº¦
    åˆ›å»ºæ–¹å¼
      Threadå­ç±»åˆ›å»º
      Runnableæ¥å£
    æ ¸å¿ƒæ–¹æ³•
      å¸¸ç”¨æ–¹æ³•
      çº¿ç¨‹åŒæ­¥
    é«˜çº§ç‰¹æ€§
      wait/notifyåè°ƒ
      æŒ‚èµ·æ¢å¤ç»ˆæ­¢
      çº¿ç¨‹è”åˆ
      å®ˆæŠ¤çº¿ç¨‹
```

**ç« èŠ‚åˆ—è¡¨**:

1. Javaä¸­çš„çº¿ç¨‹
2. çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ
3. çº¿ç¨‹çš„ä¼˜å…ˆçº§ä¸è°ƒåº¦ç®¡ç†
4. Threadçš„å­ç±»åˆ›å»ºçº¿ç¨‹
5. Runnableæ¥å£
6. çº¿ç¨‹çš„å¸¸ç”¨æ–¹æ³•
7. çº¿ç¨‹åŒæ­¥
8. ä½¿ç”¨wait()ã€notify()ã€notifyAll()åè°ƒåŒæ­¥çº¿ç¨‹
9. æŒ‚èµ·ã€æ¢å¤å’Œç»ˆæ­¢çº¿ç¨‹
10. çº¿ç¨‹è”åˆ
11. å®ˆæŠ¤çº¿ç¨‹

---

## ğŸ” 8.1 Javaä¸­çš„çº¿ç¨‹

### ğŸ’¡ å¼•è¨€

Javaæ˜¯æœ€æ—©å†…ç½®æ”¯æŒå¹¶å‘ç¼–ç¨‹çš„ä¸»æµç¼–ç¨‹è¯­è¨€ä¹‹ä¸€ã€‚

**å‘å±•å†ç¨‹**:

| æ—¶æœŸ | å…³æ³¨é‡ç‚¹ | åº”ç”¨åœºæ™¯ |
|------|---------|---------|
| æ—©æœŸ | è½»æ¾ä½¿ç”¨åå°çº¿ç¨‹ | åŠ è½½å›¾åƒã€WebæœåŠ¡å™¨å¹¶å‘è¯·æ±‚å¤„ç† |
| ç°ä»£ | å¤šå¤„ç†å™¨/å†…æ ¸ååŒå·¥ä½œ | å……åˆ†åˆ©ç”¨å¤šæ ¸CPUèµ„æº |

> ğŸ’¡ **æ ¸å¿ƒç†å¿µ**: å¤šçº¿ç¨‹çš„å¹¶å‘è¿è¡Œå¯ä»¥é€šè¿‡ä½¿ç”¨ä¸åŒçš„å¤„ç†å™¨æˆ–åœ¨åŒä¸€å¤„ç†å™¨ä¸Šä½¿ç”¨ä¸åŒçš„æ—¶é—´ç‰‡æ¥å®ç°

### ğŸ·ï¸ æ ¸å¿ƒæ¦‚å¿µå¯¹æ¯”

| æ¦‚å¿µ     | å®šä¹‰          | ç‰¹ç‚¹               |
| ------ | ----------- | ---------------- |
| **ç¨‹åº** | ä¸€æ®µé™æ€çš„ä»£ç      | åº”ç”¨è½¯ä»¶æ‰§è¡Œçš„è“æœ¬        |
| **è¿›ç¨‹** | ç¨‹åºçš„ä¸€æ¬¡åŠ¨æ€æ‰§è¡Œè¿‡ç¨‹ | ä»ä»£ç åŠ è½½ã€æ‰§è¡Œè‡³å®Œæˆçš„å®Œæ•´è¿‡ç¨‹ |
| **çº¿ç¨‹** | æ¯”è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½  | è¿›ç¨‹ä¸­çš„å¤šæ¡æ‰§è¡Œçº¿ç´¢       |

### ğŸ”„ æ‰§è¡Œæµç¨‹

```mermaid
graph TD
    A[ç¨‹åºé™æ€ä»£ç ] --> B[è¿›ç¨‹å¯åŠ¨]
    B --> C[ä¸»çº¿ç¨‹main]
    C --> D{æ˜¯å¦åˆ›å»ºå…¶ä»–çº¿ç¨‹?}
    D -->|å¦| E[mainç»“æŸ,JVMç»“æŸç¨‹åº]
    D -->|æ˜¯| F[JVMåœ¨çº¿ç¨‹é—´è½®æµåˆ‡æ¢]
    F --> G[æ‰€æœ‰çº¿ç¨‹ç»“æŸå,JVMæ‰ç»“æŸç¨‹åº]
```

### ğŸ“Œ ä¸»çº¿ç¨‹æœºåˆ¶

**ä¸»çº¿ç¨‹çš„å¯åŠ¨**:

- Javaåº”ç”¨ç¨‹åºæ€»æ˜¯ä»ä¸»ç±»çš„`main()`æ–¹æ³•å¼€å§‹æ‰§è¡Œ
- å½“JVMåŠ è½½ä»£ç å¹¶å‘ç°`main()`æ–¹æ³•åï¼Œä¼šå¯åŠ¨ä¸€ä¸ª**ä¸»çº¿ç¨‹**
- ä¸»çº¿ç¨‹è´Ÿè´£æ‰§è¡Œ`main()`æ–¹æ³•
- åœ¨`main()`æ–¹æ³•ä¸­åˆ›å»ºçš„çº¿ç¨‹ç§°ä¸º**ä¸»çº¿ç¨‹ä¸­çš„çº¿ç¨‹**

**ç¨‹åºç»“æŸæ¡ä»¶**:

| åœºæ™¯ | è¡Œä¸º |
|------|------|
| `main()`ä¸­æœªåˆ›å»ºå…¶ä»–çº¿ç¨‹ | `main()`æ‰§è¡Œå®Œæœ€åä¸€æ¡è¯­å¥æ—¶,JVMç»“æŸç¨‹åº |
| `main()`ä¸­åˆ›å»ºäº†å…¶ä»–çº¿ç¨‹ | JVMåœ¨ä¸»çº¿ç¨‹å’Œå…¶ä»–çº¿ç¨‹é—´è½®æµåˆ‡æ¢,ç›´åˆ°æ‰€æœ‰çº¿ç¨‹éƒ½ç»“æŸ |

> âš ï¸ **æ³¨æ„**: å³ä½¿`main()`æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œåªè¦è¿˜æœ‰å…¶ä»–çº¿ç¨‹åœ¨è¿è¡Œï¼ŒJVMå°±ä¸ä¼šç»“æŸJavaåº”ç”¨ç¨‹åº

---

## ğŸ” 8.2 çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ

### ğŸ·ï¸ çº¿ç¨‹çš„4ç§çŠ¶æ€

```mermaid
stateDiagram-v2
    [*] --> æ–°å»º: åˆ›å»ºçº¿ç¨‹å¯¹è±¡
    æ–°å»º --> è¿è¡Œ: start()
    è¿è¡Œ --> ä¸­æ–­: JVMåˆ‡æ¢/sleep/wait/é˜»å¡
    ä¸­æ–­ --> è¿è¡Œ: é‡æ–°è·å¾—CPUèµ„æº
    è¿è¡Œ --> æ­»äº¡: run()æ‰§è¡Œå®Œæ¯•/å¼ºåˆ¶ç»ˆæ­¢
    æ­»äº¡ --> [*]: é‡Šæ”¾å†…å­˜
```

### ğŸ“Š çŠ¶æ€è¯¦è§£

#### 1ï¸âƒ£ æ–°å»ºçŠ¶æ€ (New)

**ç‰¹å¾**:
- Threadç±»æˆ–å…¶å­ç±»çš„å¯¹è±¡è¢«å£°æ˜å¹¶åˆ›å»º
- å·²åˆ†é…å†…å­˜ç©ºé—´å’Œå…¶ä»–èµ„æº
- å°šæœªåœ¨JVMçº¿ç¨‹ç®¡ç†ä¸­æ³¨å†Œ

#### 2ï¸âƒ£ è¿è¡ŒçŠ¶æ€ (Runnable/Running)

**è¿›å…¥æ¡ä»¶**:
- çº¿ç¨‹è°ƒç”¨`start()`æ–¹æ³•é€šçŸ¥JVM
- JVMå°†çº¿ç¨‹åŠ å…¥å°±ç»ªé˜Ÿåˆ—
- çº¿ç¨‹è·å¾—CPUèµ„æºåæ‰§è¡Œ`run()`æ–¹æ³•

**é‡è¦è§„åˆ™**:

| è¦æ±‚ | è¯´æ˜ |
|------|------|
| å¿…é¡»é‡å†™`run()` | Threadç±»çš„`run()`æ–¹æ³•ä¸ºç©º,éœ€è¦åœ¨å­ç±»ä¸­é‡å†™ |
| ä¸å¯é‡å¤è°ƒç”¨`start()` | åœ¨çº¿ç¨‹æœªç»“æŸå‰å†æ¬¡è°ƒç”¨ä¼šæŠ›å‡º`IllegalThreadStateException` |

> ğŸ’¡ **å…³é”®**: `run()`æ–¹æ³•è§„å®šäº†çº¿ç¨‹çš„å…·ä½“ä½¿å‘½

#### 3ï¸âƒ£ ä¸­æ–­çŠ¶æ€ (Blocked/Waiting)

**4ç§ä¸­æ–­åŸå› **:

```mermaid
mindmap
  root((ä¸­æ–­çŠ¶æ€))
    JVMåˆ‡æ¢
      è®©å‡ºCPUä½¿ç”¨æƒ
      è¿›å…¥å°±ç»ªé˜Ÿåˆ—
    sleepæ–¹æ³•
      ä¸»åŠ¨ä¼‘çœ 
      æŒ‡å®šæ—¶é—´åè‡ªåŠ¨æ¢å¤
    waitæ–¹æ³•
      ç­‰å¾…çŠ¶æ€
      éœ€notifyå”¤é†’
    é˜»å¡çŠ¶æ€
      IOæ“ä½œç­‰
      åŸå› æ¶ˆé™¤åæ¢å¤
```

**è¯¦ç»†è¯´æ˜**:

**(a) JVMè°ƒåº¦åˆ‡æ¢**
- JVMå°†CPUèµ„æºåˆ‡æ¢ç»™å…¶ä»–çº¿ç¨‹
- å½“å‰çº¿ç¨‹è®©å‡ºCPUä½¿ç”¨æƒ
- è¿›å…¥ä¸­æ–­çŠ¶æ€

**(b) sleep()æ–¹æ³•**

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| æ–¹æ³•ç±»å‹ | Threadç±»çš„é™æ€æ–¹æ³• |
| æ‰§è¡Œæ•ˆæœ | ç«‹åˆ»è®©å‡ºCPUä½¿ç”¨æƒ |
| æ¢å¤æœºåˆ¶ | ä¼‘çœ æŒ‡å®šæ¯«ç§’åé‡æ–°æ’é˜Ÿç­‰å¾…CPU |
| ç»§ç»­ä½ç½® | ä»ä¸­æ–­å¤„ç»§ç»­è¿è¡Œ |

**(c) wait()æ–¹æ³•**

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| è¿›å…¥ç­‰å¾… | çº¿ç¨‹è¿›å…¥ä¸­æ–­(ç­‰å¾…)çŠ¶æ€ |
| ä¸»åŠ¨æ€§ | ä¸ä¼šä¸»åŠ¨è¿›å…¥å°±ç»ªé˜Ÿåˆ— |
| å”¤é†’æ–¹å¼ | å¿…é¡»ç”±å…¶ä»–çº¿ç¨‹è°ƒç”¨`notify()`æˆ–`notifyAll()` |
| ç»§ç»­ä½ç½® | ä»ä¸­æ–­å¤„ç»§ç»­è¿è¡Œ |

> ğŸ“Œ **æç¤º**: å…³äº`wait()`ã€`notify()`å’Œ`notifyAll()`è¯¦è§8.8èŠ‚

**(d) é˜»å¡çŠ¶æ€**
- æ‰§è¡ŒæŸäº›æ“ä½œ(å¦‚è¯»æ“ä½œ)å¼•èµ·é˜»å¡
- çº¿ç¨‹ä¸èƒ½è¿›å…¥æ’é˜Ÿé˜Ÿåˆ—
- é˜»å¡åŸå› æ¶ˆé™¤åæ‰èƒ½é‡æ–°æ’é˜Ÿ
- ä»åŸä¸­æ–­å¤„ç»§ç»­è¿è¡Œ

#### 4ï¸âƒ£ æ­»äº¡çŠ¶æ€ (Terminated)

**æ­»äº¡åŸå› **:

| åŸå›  | è¯´æ˜ |
|------|------|
| æ­£å¸¸ç»“æŸ | æ‰§è¡Œå®Œ`run()`æ–¹æ³•ä¸­çš„å…¨éƒ¨è¯­å¥ |
| å¼ºåˆ¶ç»ˆæ­¢ | å¼ºåˆ¶ç»“æŸ`run()`æ–¹æ³• |

> âš ï¸ **è­¦å‘Š**: `stop()`æ–¹æ³•å·²è¢«å¼ƒç”¨(deprecated)ï¼Œå› ä¸ºæœ¬è´¨ä¸Šå®ƒæ˜¯ä¸å®‰å…¨çš„ã€‚å¦‚æœçº¿ç¨‹åœ¨ä¸´ç•ŒåŒºè¢«å¼ºåˆ¶ç»ˆæ­¢ï¼Œæ•°æ®å¤„äºéƒ¨åˆ†æ›´æ–°çŠ¶æ€ï¼Œè€Œæ­¤æ—¶ä¿æŠ¤ä¸´ç•ŒåŒºçš„é”è¢«è§£é”ï¼Œå…¶ä»–çº¿ç¨‹åˆ™ä¼šä½¿ç”¨è¢«æŸåçš„æ•°æ®

**æ­»äº¡å«ä¹‰**:
- é‡Šæ”¾çº¿ç¨‹å®ä½“
- é‡Šæ”¾åˆ†é…ç»™çº¿ç¨‹å¯¹è±¡çš„å†…å­˜

---

## ğŸ” 8.3 çº¿ç¨‹çš„ä¼˜å…ˆçº§ä¸è°ƒåº¦ç®¡ç†

### ğŸ·ï¸ ä¼˜å…ˆçº§çº§åˆ«

**JVMçº¿ç¨‹è°ƒåº¦å™¨ä¼˜å…ˆçº§èŒƒå›´**:

| å¸¸é‡ | å€¼ | è¯´æ˜ |
|------|----|----|
| `Thread.MIN_PRIORITY` | 1 | æœ€ä½ä¼˜å…ˆçº§ |
| `Thread.NORM_PRIORITY` | 5 | é»˜è®¤ä¼˜å…ˆçº§ |
| `Thread.MAX_PRIORITY` | 10 | æœ€é«˜ä¼˜å…ˆçº§ |

### ğŸ› ï¸ ä¼˜å…ˆçº§è®¾ç½®

```java
// è®¾ç½®ä¼˜å…ˆçº§
thread.setPriority(int grade);  // grade: 1-10

// è·å–ä¼˜å…ˆçº§
int priority = thread.getPriority();
```

> âš ï¸ **å¼‚å¸¸**: å¦‚æœå‚æ•°ä¸åœ¨1-10èŒƒå›´å†…,ä¼šäº§ç”Ÿ`IllegalArgumentException`å¼‚å¸¸

### ğŸ“Š æ“ä½œç³»ç»Ÿå…¼å®¹æ€§

| ç³»ç»Ÿç±»å‹ | è¯†åˆ«çº§åˆ« | è¯´æ˜ |
|---------|---------|------|
| éƒ¨åˆ†æ“ä½œç³»ç»Ÿ | ä»…3ä¸ªçº§åˆ« | 1ã€5ã€10 |
| å®Œæ•´æ”¯æŒç³»ç»Ÿ | 10ä¸ªçº§åˆ« | 1-10å…¨éƒ¨è¯†åˆ« |

### âš ï¸ ä¼˜å…ˆçº§ä½¿ç”¨å»ºè®®

**ä½¿ç”¨æ³¨æ„**:
- å¯ä»¥ä¸ºçº¿ç¨‹è®¾ç½®ä¼˜å…ˆçº§ï¼Œé«˜ä¼˜å…ˆçº§çº¿ç¨‹è¢«å®‰æ’åœ¨ä½ä¼˜å…ˆçº§çº¿ç¨‹ä¹‹å‰è¿è¡Œ
- é€šå¸¸æˆ‘ä»¬å¸Œæœ›JVMå’Œä¸»æœºå¹³å°èƒ½å¤Ÿéµå®ˆä¼˜å…ˆçº§ï¼Œä½†å…·ä½“ç»†èŠ‚é«˜åº¦å–å†³äºå¹³å°
- **ä¸å»ºè®®**: ä½¿ç”¨ä¼˜å…ˆçº§æ¥ç¡®å®šçº¿ç¨‹çš„æ‰§è¡Œå…ˆåæ˜¯è„†å¼±çš„ï¼Œé€šå¸¸ä¸å»ºè®®ä½¿ç”¨

---

## ğŸ” 8.4 Threadçš„å­ç±»åˆ›å»ºçº¿ç¨‹

### ğŸ·ï¸ åŸºæœ¬åŸç†

**åˆ›å»ºæ­¥éª¤**:
1. ç»§æ‰¿Threadç±»
2. é‡å†™çˆ¶ç±»çš„`run()`æ–¹æ³•
3. åœ¨`run()`æ–¹æ³•ä¸­è§„å®šçº¿ç¨‹çš„å…·ä½“æ“ä½œ

> âš ï¸ **æ³¨æ„**: ç›¸è¾ƒäº"ç»§æ‰¿Threadç±»"ï¼Œæ›´æ¨è"å®ç°Runnableæ¥å£"(8.5èŠ‚)çš„æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹

### ğŸ’» ä»£ç ç¤ºä¾‹

#### åŸºæœ¬è¯­æ³•

```java
class MyThread extends Thread {
    @Override
    public void run() {
        // çº¿ç¨‹æ‰§è¡Œçš„ä»£ç 
        for (int i = 0; i < 5; i++) {
            System.out.println(getName() + ": " + i);
        }
    }
}

// ä½¿ç”¨
MyThread thread = new MyThread();
thread.start();  // å¯åŠ¨çº¿ç¨‹
```

#### å¸¦å‚æ•°çš„çº¿ç¨‹

```java
class CounterThread extends Thread {
    private int count;
    
    public CounterThread(String name, int count) {
        super(name);  // è®¾ç½®çº¿ç¨‹å
        this.count = count;
    }
    
    @Override
    public void run() {
        for (int i = 0; i < count; i++) {
            System.out.println(getName() + ": " + i);
            try {
                Thread.sleep(100);  // ä¼‘çœ 100ms
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }
    }
}
```

### ğŸ“‹ ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | é€‚ç”¨æ€§ |
|------|--------|
| éœ€è¦ä¸ºçº¿ç¨‹æ·»åŠ æ–°çš„æˆå‘˜å˜é‡ | âœ… é€‚ç”¨ |
| éœ€è¦ä¸ºçº¿ç¨‹æ·»åŠ æ–°çš„æ–¹æ³• | âœ… é€‚ç”¨ |
| çº¿ç¨‹ç±»éœ€è¦ç»§æ‰¿å…¶ä»–ç±» | âŒ ä¸é€‚ç”¨(Javaå•ç»§æ‰¿) |
| å¤šä¸ªçº¿ç¨‹éœ€è¦å…±äº«åŒä¸€ä»»åŠ¡ | âŒ ä¸é€‚ç”¨(æ¨èRunnable) |

---

## ğŸ” 8.5 Runnableæ¥å£

### ğŸ·ï¸ å¯¹æ¯”åˆ†æ

#### âš–ï¸ Threadå­ç±» vs Runnableæ¥å£

| æ–¹å¼         | ä¼˜ç‚¹                            | ç¼ºç‚¹                         |
| ---------- | ----------------------------- | -------------------------- |
| Threadå­ç±»   | âœ… å¯å¢åŠ æ–°æˆå‘˜å˜é‡<br>âœ… å¯å¢åŠ æ–°æ–¹æ³•        | âŒ Javaä¸æ”¯æŒå¤šç»§æ‰¿<br>âŒ ä¸èƒ½å†ç»§æ‰¿å…¶ä»–ç±» |
| Runnableæ¥å£ | âœ… å¯ç»§æ‰¿å…¶ä»–ç±»<br>âœ… æ›´çµæ´»<br>âœ… æ”¯æŒä»»åŠ¡å…±äº« | éœ€è¦ä¼ å…¥Threadæ„é€ æ–¹æ³•             |

### ğŸ› ï¸ Runnableæ¥å£åˆ›å»ºçº¿ç¨‹

**å…³é”®æ¦‚å¿µ**:

| æ¦‚å¿µ   | è¯´æ˜                    |
| ---- | --------------------- |
| ä»»åŠ¡å¯¹è±¡ | å®ç°Runnableæ¥å£çš„ç±»çš„å®ä¾‹     |
| ç›®æ ‡å¯¹è±¡ | çº¿ç¨‹çš„ä»»åŠ¡(task)           |
| æ¥å£å›è°ƒ | çº¿ç¨‹è·å¾—CPUåè‡ªåŠ¨è°ƒç”¨`run()`æ–¹æ³• |

**æ‰§è¡Œæµç¨‹**:
1. åˆ›å»ºå®ç°Runnableæ¥å£çš„ç±»
2. åˆ›å»ºè¯¥ç±»çš„å®ä¾‹(ä»»åŠ¡å¯¹è±¡)
3. å°†ä»»åŠ¡å¯¹è±¡ä¼ å…¥Threadæ„é€ æ–¹æ³•
4. è°ƒç”¨çº¿ç¨‹çš„`start()`æ–¹æ³•
5. çº¿ç¨‹è·å¾—CPUåè‡ªåŠ¨æ‰§è¡Œä»»åŠ¡çš„`run()`æ–¹æ³•

### ğŸ’» ä»£ç ç¤ºä¾‹

#### åŸºæœ¬ç”¨æ³•

```java
// 1. å®ç°Runnableæ¥å£
class MyTask implements Runnable {
    @Override
    public void run() {
        // ä»»åŠ¡ä»£ç 
        String name = Thread.currentThread().getName();
        System.out.println(name + " is running");
    }
}

// 2. åˆ›å»ºçº¿ç¨‹å¹¶ä¼ å…¥ä»»åŠ¡
MyTask task = new MyTask();
Thread thread = new Thread(task, "Thread-1");
thread.start();
```

#### å…±äº«æ•°æ®ç¤ºä¾‹

```java
class BankTask implements Runnable {
    private int balance = 100;  // å…±äº«å˜é‡
    
    @Override
    public void run() {
        String name = Thread.currentThread().getName();
        
        while (balance > 0) {
            balance -= 10;
            System.out.println(name + " å–æ¬¾åä½™é¢: " + balance);
            
            try {
                Thread.sleep(100);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }
    }
}

// ä¸¤ä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä»»åŠ¡
BankTask task = new BankTask();
Thread t1 = new Thread(task, "ATM-1");
Thread t2 = new Thread(task, "ATM-2");
t1.start();
t2.start();
```

### ğŸ·ï¸ run()æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡

#### é‡è¦ç‰¹æ€§

- å¯¹äºå…·æœ‰ç›¸åŒä»»åŠ¡çš„çº¿ç¨‹ï¼Œå½“å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹äº«ç”¨CPUèµ„æºæ—¶ï¼Œä»»åŠ¡è‡ªåŠ¨è°ƒç”¨æ¥å£ä¸­çš„`run()`æ–¹æ³•
- å½“è½®åˆ°å¦ä¸€ä¸ªçº¿ç¨‹äº«ç”¨CPUèµ„æºæ—¶ï¼Œä»»åŠ¡ä¼šå†æ¬¡è°ƒç”¨æ¥å£ä¸­çš„`run()`æ–¹æ³•
- **ä¸åŒçº¿ç¨‹çš„`run()`æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡äº’ä¸å¹²æ‰°**
- ä¸€ä¸ªçº¿ç¨‹æ”¹å˜è‡ªå·±çš„`run()`æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡ä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„å±€éƒ¨å˜é‡

#### å±€éƒ¨å˜é‡ vs æˆå‘˜å˜é‡

| å˜é‡ç±»å‹ | ä½œç”¨åŸŸ | ç‰¹æ€§ |
|---------|--------|------|
| æˆå‘˜å˜é‡ | ä»»åŠ¡å¯¹è±¡ | å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œéœ€è¦åŒæ­¥ |
| å±€éƒ¨å˜é‡ | `run()`æ–¹æ³•å†… | æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰° |

```java
class TaskDemo implements Runnable {
    private int shared = 0;  // å…±äº«å˜é‡(æˆå‘˜å˜é‡)
    
    @Override
    public void run() {
        int local = 0;  // å±€éƒ¨å˜é‡(çº¿ç¨‹ç‹¬ç«‹)
        
        for (int i = 0; i < 3; i++) {
            shared++;  // å¤šçº¿ç¨‹å…±äº«
            local++;   // çº¿ç¨‹ç‹¬ç«‹
            System.out.println(Thread.currentThread().getName() + 
                             " - shared: " + shared + ", local: " + local);
        }
    }
}
```

---

## ğŸ” 8.6 çº¿ç¨‹çš„å¸¸ç”¨æ–¹æ³•

### ğŸ“‹ æ–¹æ³•åˆ—è¡¨

```mermaid
mindmap
  root((çº¿ç¨‹æ–¹æ³•))
    å¯åŠ¨æ§åˆ¶
      startæ–¹æ³•
      runæ–¹æ³•
    çŠ¶æ€æ§åˆ¶
      sleepæ–¹æ³•
      isAliveæ–¹æ³•
    çº¿ç¨‹ç®¡ç†
      currentThreadæ–¹æ³•
      interruptæ–¹æ³•
```

### ğŸ› ï¸ æ–¹æ³•è¯¦è§£

#### 1ï¸âƒ£ start()

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| åŠŸèƒ½ | å¯åŠ¨çº¿ç¨‹ |
| æ•ˆæœ | ä½¿çº¿ç¨‹ä»æ–°å»ºçŠ¶æ€è¿›å…¥å°±ç»ªé˜Ÿåˆ— |
| æ‰§è¡Œæ—¶æœº | è½®åˆ°äº«ç”¨CPUèµ„æºæ—¶è„±ç¦»ä¸»çº¿ç¨‹ç‹¬ç«‹è¿è¡Œ |

#### 2ï¸âƒ£ run()

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| åŠŸèƒ½ | å®šä¹‰çº¿ç¨‹è¢«è°ƒåº¦åçš„æ“ä½œ |
| è°ƒç”¨æ–¹å¼ | ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨,ç”¨æˆ·ç¨‹åºä¸å¯è°ƒç”¨ |
| Threadç±» | Threadç±»çš„`run()`æ–¹æ³• |
| Runnableæ¥å£ | Runnableæ¥å£ä¸­çš„`run()`æ–¹æ³• |

#### 3ï¸âƒ£ sleep(int millisecond)

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| åŠŸèƒ½ | çº¿ç¨‹ä¼‘çœ  |
| å‚æ•° | ä¼‘çœ çš„æ¯«ç§’æ•° |
| æ•ˆæœ | ç«‹å³æ”¾å¼ƒCPUèµ„æº |
| æ¢å¤ | ä¼‘çœ æ—¶é—´åˆ°åé‡æ–°æ’é˜Ÿç­‰å¾…CPU |

```java
try {
    Thread.sleep(1000);  // ä¼‘çœ 1ç§’
} catch (InterruptedException e) {
    Thread.currentThread().interrupt();  // æ¢å¤ä¸­æ–­çŠ¶æ€
}
```

#### 4ï¸âƒ£ isAlive()

**è¿”å›å€¼è§„åˆ™**:

| çº¿ç¨‹çŠ¶æ€ | è¿”å›å€¼ |
|---------|--------|
| æœªè°ƒç”¨`start()`å‰ | `false` |
| `run()`ç»“æŸå‰ | `true` |
| è¿›å…¥æ­»äº¡çŠ¶æ€å | `false` |

```java
Thread thread = new Thread(task);
System.out.println(thread.isAlive());  // false (æœªå¯åŠ¨)

thread.start();
System.out.println(thread.isAlive());  // true (è¿è¡Œä¸­)

// ç­‰å¾…çº¿ç¨‹ç»“æŸ
while (thread.isAlive()) {
    Thread.sleep(100);
}
System.out.println(thread.isAlive());  // false (å·²ç»“æŸ)
```

> âš ï¸ **é‡è¦æé†’**: ä¸€ä¸ªå·²ç»è¿è¡Œçš„çº¿ç¨‹åœ¨æ²¡æœ‰è¿›å…¥æ­»äº¡çŠ¶æ€å‰ï¼Œä¸è¦å†ç»™çº¿ç¨‹åˆ†é…å®ä½“ã€‚ç”±äºçº¿ç¨‹åªèƒ½å¼•ç”¨æœ€ååˆ†é…çš„å®ä½“ï¼Œå…ˆå‰çš„å®ä½“ä¼šæˆä¸º"åƒåœ¾"ï¼Œå¹¶ä¸”ä¸ä¼šè¢«åƒåœ¾æ”¶é›†æœºåˆ¶æ”¶é›†

#### 5ï¸âƒ£ currentThread()

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| æ–¹æ³•ç±»å‹ | Threadç±»çš„é™æ€æ–¹æ³• |
| è°ƒç”¨æ–¹å¼ | `Thread.currentThread()` |
| è¿”å›å€¼ | å½“å‰æ­£åœ¨ä½¿ç”¨CPUèµ„æºçš„çº¿ç¨‹ |

```java
Thread current = Thread.currentThread();
String name = current.getName();        // çº¿ç¨‹å
long id = current.getId();              // çº¿ç¨‹ID
int priority = current.getPriority();   // ä¼˜å…ˆçº§
```

#### 6ï¸âƒ£ interrupt()

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| åŠŸèƒ½ | "å”¤é†’"ä¼‘çœ çš„çº¿ç¨‹ |
| æ•ˆæœ | å¯¼è‡´ä¼‘çœ çº¿ç¨‹å‘ç”Ÿ`InterruptedException`å¼‚å¸¸ |
| ç»“æœ | ç»“æŸä¼‘çœ ,é‡æ–°æ’é˜Ÿç­‰å¾…CPUèµ„æº |

```java
// çº¿ç¨‹A: ä¼‘çœ 10ç§’
Thread threadA = new Thread(() -> {
    try {
        System.out.println("å¼€å§‹ä¼‘çœ ...");
        Thread.sleep(10000);
        System.out.println("è‡ªç„¶é†’æ¥");
    } catch (InterruptedException e) {
        System.out.println("è¢«ä¸­æ–­å”¤é†’");
    }
});
threadA.start();

// çº¿ç¨‹B: 1ç§’åå”¤é†’çº¿ç¨‹A
Thread.sleep(1000);
threadA.interrupt();  // ä¸­æ–­çº¿ç¨‹Açš„ä¼‘çœ 
```

---

## ğŸ” 8.7 çº¿ç¨‹åŒæ­¥

### ğŸ·ï¸ åŒæ­¥æ¦‚å¿µ

**çº¿ç¨‹åŒæ­¥çš„å®šä¹‰**:
- å¤šä¸ªçº¿ç¨‹è¦æ‰§è¡Œä¸€ä¸ª`synchronized`ä¿®é¥°çš„æ–¹æ³•
- å½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œè¯¥æ–¹æ³•æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…
- ç›´åˆ°è¯¥æ–¹æ³•è¿”å›ï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½æ‰§è¡Œ

**åŒæ­¥æœºåˆ¶**:

```mermaid
sequenceDiagram
    participant çº¿ç¨‹A
    participant synchronizedæ–¹æ³•
    participant çº¿ç¨‹B
    
    çº¿ç¨‹A->>synchronizedæ–¹æ³•: è°ƒç”¨å¹¶å ç”¨
    çº¿ç¨‹B->>synchronizedæ–¹æ³•: å°è¯•è°ƒç”¨
    synchronizedæ–¹æ³•-->>çº¿ç¨‹B: é˜»å¡ç­‰å¾…
    çº¿ç¨‹A->>synchronizedæ–¹æ³•: æ‰§è¡Œå®Œæ¯•è¿”å›
    synchronizedæ–¹æ³•-->>çº¿ç¨‹B: è§£é™¤é˜»å¡
    çº¿ç¨‹B->>synchronizedæ–¹æ³•: å¼€å§‹æ‰§è¡Œ
```

### ğŸ”’ synchronizedå…³é”®å­—

**ä½¿ç”¨æ–¹å¼**:
```java
public synchronized void methodName() {
    // åŒæ­¥ä»£ç å—
}
```

### ğŸ’» ä»£ç ç¤ºä¾‹

#### åŒæ­¥æ–¹æ³•

```java
class BankAccount {
    private int balance = 100;
    
    // synchronizedä¿®é¥°æ–¹æ³•
    public synchronized void withdraw(int amount) {
        if (balance >= amount) {
            balance -= amount;
            System.out.println(Thread.currentThread().getName() + 
                             " å–æ¬¾ " + amount + "ï¼Œä½™é¢: " + balance);
        }
    }
}
```

#### åŒæ­¥ä»£ç å—

```java
class Counter {
    private int count = 0;
    private Object lock = new Object();
    
    public void increment() {
        synchronized(lock) {  // åŒæ­¥ä»£ç å—
            count++;
        }
    }
}
```

### ğŸ“Š åŒæ­¥ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | ä½¿ç”¨æ–¹å¼ |
|------|---------|
| æ•´ä¸ªæ–¹æ³•éƒ½æ˜¯ä¸´ç•ŒåŒº | ä½¿ç”¨`synchronized`æ–¹æ³• |
| éƒ¨åˆ†ä»£ç æ˜¯ä¸´ç•ŒåŒº | ä½¿ç”¨`synchronized`ä»£ç å— |
| éœ€è¦è‡ªå®šä¹‰é”å¯¹è±¡ | ä½¿ç”¨`synchronized(lock)` |
| é™æ€æ–¹æ³•åŒæ­¥ | ä½¿ç”¨`static synchronized` |

---

## ğŸ” 8.8 ä½¿ç”¨wait()ã€notify()ã€notifyAll()åè°ƒåŒæ­¥çº¿ç¨‹

### ğŸ·ï¸ åŸºæœ¬æ¦‚å¿µ

**æ–¹æ³•æ¥æº**:
- `wait()`ã€`notify()`å’Œ`notifyAll()`éƒ½æ˜¯Objectç±»ä¸­çš„finalæ–¹æ³•
- è¢«æ‰€æœ‰çš„ç±»ç»§æ‰¿
- ä¸å…è®¸é‡å†™

### ğŸ¤ åè°ƒæœºåˆ¶

**ä½¿ç”¨åœºæ™¯**:
- å½“ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨åŒæ­¥æ–¹æ³•ä¸­çš„æŸä¸ªå˜é‡
- æ­¤å˜é‡éœ€è¦å…¶ä»–çº¿ç¨‹ä¿®æ”¹åæ‰èƒ½ç¬¦åˆæœ¬çº¿ç¨‹éœ€è¦
- å…¸å‹åœºæ™¯: ç”Ÿäº§è€…-æ¶ˆè´¹è€…(producer-consumer)é—®é¢˜

**å·¥ä½œæµç¨‹**:

```mermaid
sequenceDiagram
    participant çº¿ç¨‹A
    participant synchronizedæ–¹æ³•
    participant çº¿ç¨‹B
    
    çº¿ç¨‹A->>synchronizedæ–¹æ³•: è¿›å…¥,æ£€æŸ¥æ¡ä»¶
    synchronizedæ–¹æ³•->>çº¿ç¨‹A: æ¡ä»¶ä¸æ»¡è¶³
    çº¿ç¨‹A->>synchronizedæ–¹æ³•: wait()ç­‰å¾…
    Note over çº¿ç¨‹A: é‡Šæ”¾é”,è¿›å…¥ç­‰å¾…
    
    çº¿ç¨‹B->>synchronizedæ–¹æ³•: è¿›å…¥,ä¿®æ”¹æ¡ä»¶
    çº¿ç¨‹B->>synchronizedæ–¹æ³•: notifyAll()
    Note over çº¿ç¨‹A: è¢«å”¤é†’,é‡æ–°æ’é˜Ÿ
    çº¿ç¨‹B->>synchronizedæ–¹æ³•: æ‰§è¡Œå®Œæ¯•,é‡Šæ”¾é”
    
    çº¿ç¨‹A->>synchronizedæ–¹æ³•: é‡æ–°è·å¾—é”
    çº¿ç¨‹A->>synchronizedæ–¹æ³•: ä»wait()å¤„ç»§ç»­
```

### ğŸ” ä¸synchronizedé…åˆä½¿ç”¨

**å¿…é¡»é…åˆä½¿ç”¨çš„åŸå› **:

| è¦æ±‚ | åŸå›  |
|------|------|
| å¿…é¡»åœ¨synchronizedå—ä¸­ | ç¡®ä¿å·²è·å–å¯¹è±¡çš„ç›‘è§†å™¨é” |
| ä¿è¯æ“ä½œåŸå­æ€§ | æ£€æŸ¥æ¡ä»¶å’Œè¿›å…¥ç­‰å¾…å¿…é¡»æ˜¯åŸå­æ“ä½œ |
| é¿å…é€šçŸ¥ä¸¢å¤± | é˜²æ­¢notifyåœ¨waitä¹‹å‰æ‰§è¡Œå¯¼è‡´æ°¸ä¹…ç­‰å¾… |

> âš ï¸ **å…³é”®**: `synchronized`ç¡®ä¿äº†æ£€æŸ¥æ¡ä»¶å’Œè¿›å…¥ç­‰å¾…çš„åŸå­æ€§

### ğŸ“Š ç›‘æ§å™¨æ¨¡å¼

**Javaçš„ç­‰å¾…/é€šçŸ¥æœºåˆ¶**:

| é˜¶æ®µ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| è¿›å…¥ç›‘æ§å™¨ | `synchronized`è·å–é” | çº¿ç¨‹A |
| ç­‰å¾…æ¡ä»¶ | `wait()`é‡Šæ”¾é”å¹¶ç­‰å¾… | åªæœ‰æŒæœ‰é”çš„çº¿ç¨‹æ‰èƒ½è°ƒç”¨ |
| é€šçŸ¥æ¡ä»¶å˜åŒ– | `notify()`/`notifyAll()` | åªæœ‰æŒæœ‰é”çš„çº¿ç¨‹æ‰èƒ½è°ƒç”¨(çº¿ç¨‹B) |
| é€€å‡ºç›‘æ§å™¨ | é€€å‡ºåŒæ­¥å—é‡Šæ”¾é” | çº¿ç¨‹B |

### ğŸ’» ä»£ç ç¤ºä¾‹

#### åŸºæœ¬æ¨¡æ¿

```java
class SharedResource {
    private boolean ready = false;
    
    // ç­‰å¾…è€…
    public synchronized void waitForCondition() {
        while (!ready) {  // ä½¿ç”¨whileè€Œéif
            try {
                wait();  // ç­‰å¾…
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }
        // æ¡ä»¶æ»¡è¶³ï¼Œæ‰§è¡Œä¸šåŠ¡
        System.out.println("æ¡ä»¶æ»¡è¶³ï¼Œå¼€å§‹å·¥ä½œ");
    }
    
    // é€šçŸ¥è€…
    public synchronized void setReady() {
        ready = true;
        notifyAll();  // å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹
    }
}
```

#### ç”Ÿäº§è€…-æ¶ˆè´¹è€…ç¤ºä¾‹

```java
class Buffer {
    private int[] items = new int[10];
    private int count = 0;
    
    // ç”Ÿäº§è€…
    public synchronized void produce(int item) throws InterruptedException {
        while (count == items.length) {
            wait();  // ç¼“å†²åŒºæ»¡ï¼Œç­‰å¾…
        }
        items[count++] = item;
        System.out.println("ç”Ÿäº§: " + item);
        notifyAll();  // é€šçŸ¥æ¶ˆè´¹è€…
    }
    
    // æ¶ˆè´¹è€…
    public synchronized int consume() throws InterruptedException {
        while (count == 0) {
            wait();  // ç¼“å†²åŒºç©ºï¼Œç­‰å¾…
        }
        int item = items[--count];
        System.out.println("æ¶ˆè´¹: " + item);
        notifyAll();  // é€šçŸ¥ç”Ÿäº§è€…
        return item;
    }
}
```

### ğŸ“Œ é‡è¦æ³¨æ„äº‹é¡¹

| æ³¨æ„ç‚¹ | è¯´æ˜ |
|--------|------|
| ä½¿ç”¨whileè€Œéif | é˜²æ­¢è™šå‡å”¤é†’,è¢«å”¤é†’åé‡æ–°æ£€æŸ¥æ¡ä»¶ |
| å¿…é¡»åœ¨synchronizedä¸­ | å¦åˆ™æŠ›å‡º`IllegalMonitorStateException` |
| ä¼˜å…ˆä½¿ç”¨notifyAll | é¿å…ä¿¡å·ä¸¢å¤±,ç¡®ä¿æ‰€æœ‰ç­‰å¾…çº¿ç¨‹è¢«å”¤é†’ |
| å¤„ç†InterruptedException | æ­£ç¡®å“åº”çº¿ç¨‹ä¸­æ–­ |

---

## ğŸ” 8.9 æŒ‚èµ·ã€æ¢å¤å’Œç»ˆæ­¢çº¿ç¨‹

### ğŸ·ï¸ çº¿ç¨‹æŒ‚èµ·ä¸æ¢å¤

**å®ç°æœºåˆ¶**:
- ä½¿ç”¨`wait()`å®ç°æŒ‚èµ·
- ä½¿ç”¨`notify()`/`notifyAll()`å®ç°æ¢å¤
- éœ€è¦é…åˆ`volatile`å…³é”®å­—ä¿è¯å¯è§æ€§

### ğŸ’» ä»£ç ç¤ºä¾‹

```java
class ControlTask implements Runnable {
    private volatile boolean suspended = false;  // volatileä¿è¯å¯è§æ€§
    
    public boolean isSuspended() {
        return suspended;
    }
    
    @Override
    public void run() {
        while (true) {
            // æ‰§è¡Œå·¥ä½œ
            doWork();
            
            // æ£€æŸ¥æ˜¯å¦éœ€è¦æŒ‚èµ·
            if (shouldSuspend()) {
                try {
                    suspended = true;
                    suspend();
                    suspended = false;
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                    break;
                }
            }
        }
    }
    
    public synchronized void suspend() throws InterruptedException {
        wait();
    }
    
    public synchronized void resume() {
        notifyAll();
    }
    
    private void doWork() { /* å·¥ä½œé€»è¾‘ */ }
    private boolean shouldSuspend() { return false; }
}
```

### ğŸ“Œ å…³é”®è¦ç‚¹

| è¦ç‚¹ | è¯´æ˜ |
|------|------|
| volatileå…³é”®å­— | ä¿è¯å˜é‡ä¿®æ”¹å¯¹å…¶ä»–çº¿ç¨‹å¯è§ |
| synchronizedæ–¹æ³• | suspend()å’Œresume()å¿…é¡»åŒæ­¥ |
| çŠ¶æ€æ ‡å¿— | ä½¿ç”¨å¸ƒå°”æ ‡å¿—è®°å½•æŒ‚èµ·çŠ¶æ€ |
| ä¸»çº¿ç¨‹ç›‘æ§ | ä¸»çº¿ç¨‹æ£€æµ‹çŠ¶æ€å¹¶æ§åˆ¶æ¢å¤ |

> ğŸ’¡ **å…³é”®**: å°†å˜é‡å£°æ˜ä¸º`volatile`ï¼Œå¯ä»¥ä¿è¯å˜é‡çš„å€¼ä¿®æ”¹åå¯¹å…¶ä»–çº¿ç¨‹(ä¾‹å¦‚ä¸»çº¿ç¨‹)æ˜¯å¯è§çš„

---

## ğŸ” 8.10 çº¿ç¨‹è”åˆ

### ğŸ·ï¸ è”åˆæ¦‚å¿µ

**åŸºæœ¬åŸç†**:
- çº¿ç¨‹Aåœ¨å æœ‰CPUæœŸé—´å¯ä»¥è®©çº¿ç¨‹Bè°ƒç”¨`join()`æ–¹æ³•ä¸è‡ªå·±è”åˆ
- è¯­æ³•: `B.join();`
- æ•ˆæœ: Açº¿ç¨‹ç«‹åˆ»ä¸­æ–­æ‰§è¡Œï¼Œç­‰å¾…Bçº¿ç¨‹æ‰§è¡Œå®Œæ¯•
- Açº¿ç¨‹ç­‰Bæ‰§è¡Œå®Œåé‡æ–°æ’é˜Ÿç­‰å¾…CPUèµ„æº

**æ‰§è¡Œæµç¨‹**:

```mermaid
sequenceDiagram
    participant çº¿ç¨‹A
    participant çº¿ç¨‹B
    participant CPU
    
    CPU->>çº¿ç¨‹A: åˆ†é…CPUèµ„æº
    çº¿ç¨‹A->>çº¿ç¨‹B: è°ƒç”¨B.join()
    Note over çº¿ç¨‹A: ç«‹å³ä¸­æ–­æ‰§è¡Œ
    CPU->>çº¿ç¨‹B: åˆ†é…CPUèµ„æº
    çº¿ç¨‹B->>çº¿ç¨‹B: æ‰§è¡Œå®Œæ¯•
    Note over çº¿ç¨‹A: é‡æ–°æ’é˜Ÿ
    CPU->>çº¿ç¨‹A: é‡æ–°åˆ†é…CPU
    çº¿ç¨‹A->>çº¿ç¨‹A: æ¢å¤æ‰§è¡Œ
```

> ğŸ’¡ **æç¤º**: å¦‚æœBçº¿ç¨‹å·²ç»ç»“æŸï¼Œ`B.join()`ä¸ä¼šäº§ç”Ÿä»»ä½•æ•ˆæœ

### ğŸ’» ä»£ç ç¤ºä¾‹

```java
Thread thread1 = new Thread(() -> {
    System.out.println("ä»»åŠ¡1å¼€å§‹");
    try { Thread.sleep(2000); } catch (InterruptedException e) {}
    System.out.println("ä»»åŠ¡1å®Œæˆ");
});

Thread thread2 = new Thread(() -> {
    System.out.println("ç­‰å¾…ä»»åŠ¡1å®Œæˆ...");
    try {
        thread1.join();  // ç­‰å¾…thread1å®Œæˆ
    } catch (InterruptedException e) {
        Thread.currentThread().interrupt();
    }
    System.out.println("ä»»åŠ¡1å·²å®Œæˆï¼Œå¼€å§‹ä»»åŠ¡2");
});

thread1.start();
thread2.start();
```

### ğŸ“Š join()æ–¹æ³•å˜ä½“

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `join()` | æ— é™ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢ |
| `join(long millis)` | æœ€å¤šç­‰å¾…millisæ¯«ç§’ |
| `join(long millis, int nanos)` | æ›´ç²¾ç¡®çš„ç­‰å¾…æ—¶é—´ |

### ğŸ“Œ ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | è¯´æ˜ |
|------|------|
| ä»»åŠ¡ä¾èµ– | ä»»åŠ¡Bä¾èµ–ä»»åŠ¡Açš„ç»“æœ |
| é¡ºåºæ‰§è¡Œ | ç¡®ä¿ä»»åŠ¡æŒ‰ç‰¹å®šé¡ºåºæ‰§è¡Œ |
| æ•°æ®åŒæ­¥ | ç­‰å¾…æ•°æ®å‡†å¤‡å®Œæˆ |
| èµ„æºåˆå§‹åŒ– | ç­‰å¾…èµ„æºåˆå§‹åŒ–å®Œæˆ |

---

## ğŸ” 8.11 å®ˆæŠ¤çº¿ç¨‹

### ğŸ·ï¸ å®ˆæŠ¤çº¿ç¨‹æ¦‚å¿µ

**åŸºæœ¬å®šä¹‰**:

| çº¿ç¨‹ç±»å‹ | è¯´æ˜ |
|---------|------|
| ç”¨æˆ·çº¿ç¨‹ | é»˜è®¤ç±»å‹,éœ€è¦æ‰§è¡Œå®Œæ‰€æœ‰è¯­å¥ |
| å®ˆæŠ¤çº¿ç¨‹ | å½“æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ç»“æŸæ—¶ç«‹å³ç»“æŸ |

**è®¾ç½®æ–¹æ³•**:
```java
thread.setDaemon(true); // è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹
```

> âš ï¸ **æ³¨æ„**: çº¿ç¨‹å¿…é¡»åœ¨è¿è¡Œä¹‹å‰è®¾ç½®æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹

### ğŸŒ™ å®ˆæŠ¤çº¿ç¨‹ç‰¹æ€§

**ç»“æŸæ¡ä»¶**:
- å½“ç¨‹åºä¸­æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹éƒ½å·²ç»“æŸè¿è¡Œæ—¶
- å³ä½¿å®ˆæŠ¤çº¿ç¨‹çš„`run()`æ–¹æ³•ä¸­è¿˜æœ‰éœ€è¦æ‰§è¡Œçš„è¯­å¥
- å®ˆæŠ¤çº¿ç¨‹ä¹Ÿç«‹åˆ»ç»“æŸè¿è¡Œ

**ä½¿ç”¨åœºæ™¯**:
- åšä¸€äº›ä¸æ˜¯å¾ˆä¸¥æ ¼çš„å·¥ä½œ
- çº¿ç¨‹çš„éšæ—¶ç»“æŸä¸ä¼šäº§ç”Ÿä¸è‰¯åæœ
- ä¾‹å¦‚: åå°ç›‘æ§ã€æ—¥å¿—è®°å½•ç­‰

### ğŸ’» ä»£ç ç¤ºä¾‹

```java
Thread daemon = new Thread(() -> {
    while (true) {
        System.out.println("å®ˆæŠ¤çº¿ç¨‹è¿è¡Œä¸­...");
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            break;
        }
    }
});

daemon.setDaemon(true);  // è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹(å¿…é¡»åœ¨start()ä¹‹å‰)
daemon.start();
```

### ğŸ“Š å®ˆæŠ¤çº¿ç¨‹åº”ç”¨åœºæ™¯

| åœºæ™¯ | ç¤ºä¾‹ |
|------|------|
| åå°ç›‘æ§ | ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ |
| æ—¥å¿—è®°å½• | å¼‚æ­¥å†™å…¥æ—¥å¿— |
| åƒåœ¾å›æ”¶ | JVMçš„åƒåœ¾å›æ”¶çº¿ç¨‹ |
| å¿ƒè·³æ£€æµ‹ | å®šæœŸå‘é€å¿ƒè·³åŒ… |
| ç¼“å­˜æ¸…ç† | å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜ |

### ğŸ“Œ é‡è¦æ³¨æ„äº‹é¡¹

| æ³¨æ„ç‚¹ | è¯´æ˜ |
|--------|------|
| è®¾ç½®æ—¶æœº | å¿…é¡»åœ¨`start()`ä¹‹å‰è°ƒç”¨`setDaemon(true)` |
| çªç„¶ç»ˆæ­¢ | å®ˆæŠ¤çº¿ç¨‹å¯èƒ½åœ¨ä»»ä½•æ—¶åˆ»çªç„¶ç»ˆæ­¢ |
| èµ„æºæ¸…ç† | ä¸è¦åœ¨å®ˆæŠ¤çº¿ç¨‹ä¸­æ‰§è¡Œé‡è¦çš„èµ„æºæ¸…ç†å·¥ä½œ |
| finallyå— | å®ˆæŠ¤çº¿ç¨‹çš„finallyå—ä¸ä¿è¯æ‰§è¡Œ |

> ğŸ’¡ **è¯´æ˜**: å½“ç”¨æˆ·çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å,å®ˆæŠ¤çº¿ç¨‹ç«‹å³ç»“æŸ,å³ä½¿whileå¾ªç¯è¿˜åœ¨è¿è¡Œ

---

## ğŸ† è¡¥å……çŸ¥è¯†

### ğŸŠ çº¿ç¨‹æ±  (Thread Pools)

#### ğŸ“Š ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜

**ä¼ ç»Ÿåˆ›å»ºçº¿ç¨‹çš„æ­¥éª¤**:

```mermaid
graph LR
    A[Step 1: åˆ›å»ºRunnableå¯¹è±¡] --> B[Step 2: åˆ›å»ºThreadå¯¹è±¡]
    B --> C[Step 3: è°ƒç”¨startæ–¹æ³•]
    C --> D[Step 4: çº¿ç¨‹æ‰§è¡Œrunæ–¹æ³•]
```

**å­˜åœ¨çš„é—®é¢˜**:
- ä¸ºæ¯ä¸ªä»»åŠ¡åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹
- å¤§é‡ä»»åŠ¡æ—¶ä¼šé™åˆ¶ååé‡
- å¯¼è‡´æ€§èƒ½ä¸‹é™

#### ğŸ—ï¸ çº¿ç¨‹æ± è§£å†³æ–¹æ¡ˆ

**ExecutorServiceæ¥å£**:

| ç»„ä»¶ | è¯´æ˜ |
|------|------|
| `Executor` | æ‰§è¡Œä»»åŠ¡çš„åŸºç¡€æ¥å£ |
| `ExecutorService` | ç®¡ç†å’Œæ§åˆ¶ä»»åŠ¡çš„æ¥å£(Executorçš„å­æ¥å£) |

**åŸºæœ¬ä½¿ç”¨**:

```java
import java.util.concurrent.*;

// åˆ›å»ºçº¿ç¨‹æ± 
ExecutorService executor = Executors.newFixedThreadPool(3);

// æäº¤ä»»åŠ¡
executor.execute(() -> {
    System.out.println(Thread.currentThread().getName() + " æ‰§è¡Œä»»åŠ¡");
});

// å…³é—­çº¿ç¨‹æ± 
executor.shutdown();
```

**çº¿ç¨‹æ± ç±»å‹**:

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `newFixedThreadPool(n)` | å›ºå®šå¤§å°ä¸ºnçš„çº¿ç¨‹æ±  |
| `newCachedThreadPool()` | å¯ç¼“å­˜çº¿ç¨‹æ± ,æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹ |
| `newSingleThreadExecutor()` | å•çº¿ç¨‹çš„çº¿ç¨‹æ±  |
| `newScheduledThreadPool(n)` | æ”¯æŒå®šæ—¶å’Œå‘¨æœŸæ€§ä»»åŠ¡ |

> ğŸ’¡ **å»ºè®®**: å¦‚æœåªéœ€ä¸ºä¸€ä¸ªä»»åŠ¡åˆ›å»ºçº¿ç¨‹ï¼Œä½¿ç”¨Threadç±»ã€‚å¦‚æœéœ€è¦ä¸ºå¤šä¸ªä»»åŠ¡åˆ›å»ºçº¿ç¨‹ï¼Œä½¿ç”¨çº¿ç¨‹æ± æ›´å¥½

---

### ğŸ”’ ä½¿ç”¨Lockè¿›è¡ŒåŒæ­¥

#### ğŸ“‹ é”çš„æ¦‚å¿µ

**ä¸ºä»€ä¹ˆéœ€è¦é”**:
- é¿å…å…±äº«å˜é‡è¢«ç ´å
- ç¡®ä¿ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¡ç®—å’Œè®¾ç½®æ–°å€¼
- å¿…é¡»åœ¨ä¸ä¸­æ–­çš„æƒ…å†µä¸‹å®Œæ•´æ‰§è¡Œçš„ä»£ç ç§°ä¸º**ä¸´ç•ŒåŒº**(critical region/section)

#### ğŸ› ï¸ Lockæ¥å£

```java
import java.util.concurrent.locks.*;

Lock lock = new ReentrantLock();

lock.lock();  // è·å–é”
try {
    // ä¸´ç•ŒåŒºä»£ç 
} finally {
    lock.unlock();  // é‡Šæ”¾é”(å¿…é¡»åœ¨finallyä¸­)
}
```

**å·¥ä½œæœºåˆ¶**:
- æ‰§è¡Œ`lock()`çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹é”å®šå¯¹è±¡
- å…¶ä»–çº¿ç¨‹è°ƒç”¨`lock()`æ—¶è¢«é˜»å¡
- ç›´åˆ°ç¬¬ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨`unlock()`

> âš ï¸ **é‡è¦**: é€šè¿‡å°†`unlock()`æ”¾å…¥finallyå­å¥ï¼Œå¦‚æœä¸´ç•ŒåŒºå‘ç”Ÿå¼‚å¸¸ï¼Œé”å°†è¢«é‡Šæ”¾ï¼›å¦åˆ™é”å°†è¢«æ°¸ä¹…é”å®š

#### âš–ï¸ synchronized vs Lock

**å¯¹æ¯”åˆ†æ**:

| ç‰¹æ€§ | synchronized | Lock |
|------|-------------|------|
| ä½¿ç”¨éš¾åº¦ | ç®€å• | éœ€è¦æ˜¾å¼åŠ é”/è§£é” |
| çµæ´»æ€§ | è¾ƒä½ | é«˜,æ›´ç›´è§‚ |
| é€‚ç”¨åœºæ™¯ | ç®€å•äº’æ–¥ | å¤æ‚æ¡ä»¶åŒæ­¥ |
| é”çš„è·å– | éšå¼è·å–å†…éƒ¨é” | æ˜¾å¼è·å–Lockå¯¹è±¡ |
| å¯ä¸­æ–­ | ä¸æ”¯æŒ | æ”¯æŒ`lockInterruptibly()` |
| å°è¯•è·å– | ä¸æ”¯æŒ | æ”¯æŒ`tryLock()` |
| å…¬å¹³é” | éå…¬å¹³ | å¯é€‰å…¬å¹³/éå…¬å¹³ |

> ğŸ’¡ **å»ºè®®**: ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨synchronizedæ›´ç®€å•ã€‚ä½†ä½¿ç”¨æ˜¾å¼é”å¯¹äºå¸¦æ¡ä»¶çš„çº¿ç¨‹åŒæ­¥æ›´ç›´è§‚å’Œçµæ´»

---

### ğŸ¤ çº¿ç¨‹åä½œ (Cooperation among Threads)

#### ğŸ“‹ Conditionæ¡ä»¶å¯¹è±¡

**ä¸ºä»€ä¹ˆéœ€è¦æ¡ä»¶å¯¹è±¡**:
- çº¿ç¨‹åŒæ­¥å¯ä»¥é¿å…ç«æ€æ¡ä»¶
- ä½†æœ‰æ—¶è¿˜éœ€è¦çº¿ç¨‹ä¹‹é—´è¿›è¡Œåä½œ
- Conditionå¯ä»¥ç”¨äºçº¿ç¨‹é—´é€šä¿¡

**Conditionæ–¹æ³•**:

| æ–¹æ³• | å¯¹åº”Objectæ–¹æ³• | è¯´æ˜ |
|------|---------------|------|
| `await()` | `wait()` | å½“å‰çº¿ç¨‹ç­‰å¾… |
| `signal()` | `notify()` | å”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ |
| `signalAll()` | `notifyAll()` | å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ |

#### ğŸ’» Conditionä½¿ç”¨ç¤ºä¾‹

```java
import java.util.concurrent.locks.*;

Lock lock = new ReentrantLock();
Condition condition = lock.newCondition();
boolean ready = false;

// ç­‰å¾…
lock.lock();
try {
    while (!ready) {
        condition.await();
    }
    // æ‰§è¡Œä¸šåŠ¡
} finally {
    lock.unlock();
}

// é€šçŸ¥
lock.lock();
try {
    ready = true;
    condition.signalAll();
} finally {
    lock.unlock();
}
```

---

## ğŸ—‚ï¸ çŸ¥è¯†ä½“ç³»æ€»ç»“

```mermaid
mindmap
  root((Javaçº¿ç¨‹))
    åŸºç¡€æ¦‚å¿µ
      ç¨‹åºè¿›ç¨‹çº¿ç¨‹
      ä¸»çº¿ç¨‹æœºåˆ¶
      ç”Ÿå‘½å‘¨æœŸ4çŠ¶æ€
    åˆ›å»ºæ–¹å¼
      Threadå­ç±»
        ä¼˜ç‚¹çµæ´»
        ç¼ºç‚¹å•ç»§æ‰¿
      Runnableæ¥å£
        ä¼˜ç‚¹å¯å¤šç»§æ‰¿
        æ¨èä½¿ç”¨
    çŠ¶æ€ç®¡ç†
      startå¯åŠ¨
      runæ‰§è¡Œ
      sleepä¼‘çœ 
      isAliveæ£€æµ‹
    çº¿ç¨‹åè°ƒ
      synchronizedåŒæ­¥
      waitç­‰å¾…
      notifyå”¤é†’
      Lockæ˜¾å¼é”
    é«˜çº§ç‰¹æ€§
      çº¿ç¨‹ä¼˜å…ˆçº§
      çº¿ç¨‹è”åˆjoin
      å®ˆæŠ¤çº¿ç¨‹daemon
      çº¿ç¨‹æ± pool
```
